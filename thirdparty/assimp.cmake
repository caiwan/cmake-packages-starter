include (ExternalProject)

if(CMAKE_SIZEOF_VOID_P EQUAL 8)
	set(ASSIMP_ARCHITECTURE "x64")
elseif(CMAKE_SIZEOF_VOID_P EQUAL 4)
	set(ASSIMP_ARCHITECTURE "")
endif(CMAKE_SIZEOF_VOID_P EQUAL 8)
	
MESSAGE("CMAKE_SIZEOF_VOID_P=${CMAKE_SIZEOF_VOID_P}")

SET(PREFIX Assimp)
SET(GIT_URL https://github.com/assimp/assimp.git)
SET(GIT_TAG v4.1.0)

SET(ASSIMP_INSTALL_DIR ${CMAKE_BINARY_DIR}/externals/ CACHE PATH "" FORCE)

ExternalProject_Add(${PREFIX}
  GIT_REPOSITORY "${GIT_URL}"
  GIT_TAG "${GIT_TAG}"
  PREFIX "${CMAKE_CURRENT_BINARY_DIR}"
  UPDATE_COMMAND ""
  PATCH_COMMAND ""
  CMAKE_ARGS -DASSIMP_BUILD_TESTS=OFF -DCMAKE_INSTALL_PREFIX=${ASSIMP_INSTALL_DIR}
  TEST_COMMAND ""
)

MESSAGE("ASSIMP_INSTALL_DIR=${ASSIMP_INSTALL_DIR}")

SET(ASSIMP_BINARY_DIR ${ASSIMP_INSTALL_DIR}/bin CACHE PATH "")
SET(ASSIMP_LIBRARY_DIR ${ASSIMP_INSTALL_DIR}/lib CACHE PATH "")
SET(ASSIMP_INCLUDE_DIR ${ASSIMP_INSTALL_DIR}/include CACHE PATH "")

# MSVC only 
if(MSVC12)
    set(ASSIMP_MSVC_VERSION "vc120")
elseif(MSVC14)	
    set(ASSIMP_MSVC_VERSION "vc140")
endif(MSVC12)

SET(ASSIMP_LIBRARY_RELEASE assimp-${ASSIMP_MSVC_VERSION}-mt.lib CACHE STRING "")
SET(ASSIMP_LIBRARY_DEBUG assimp-${ASSIMP_MSVC_VERSION}-mtd.lib CACHE STRING "")

set(ASSIMP_LIBRARY 
    ${ASSIMP_LIBRARY_RELEASE}
    # For some reason, it sucks
    # optimized 	${ASSIMP_LIBRARY_RELEASE}
    # debug		${ASSIMP_LIBRARY_DEBUG}
    CACHE INTERNAL "" FORCE
)

SET(ASSIMP_BINARY_RELEASE assimp-${ASSIMP_MSVC_VERSION}-mt.dll CACHE STRING "")
SET(ASSIMP_BINARY_DEBUG assimp-${ASSIMP_MSVC_VERSION}-mtd.dll CACHE STRING "")

SET(ASSIMP_BINARIES
    ${ASSIMP_BINARY_DIR}/${ASSIMP_BINARY_RELEASE}
    # ${ASSIMP_BINARY_DIR}/${ASSIMP_BINARY_DEBUG}
CACHE INTERNAL "" FORCE)

# set(ASSIMP_LIBRARIES ${ASSIMP_LIBRARY_RELEASE} ${ASSIMP_LIBRARY_DEBUG})
