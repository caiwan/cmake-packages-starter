enable_testing()

file(GLOB_RECURSE SOURCE_FILES *.cpp)
file(GLOB_RECURSE HEADER_FILES *.h)

include_directories("${GTEST_INCLUDE_DIR}")

add_executable(UnitTests EXCLUDE_FROM_ALL ${SOURCE_FILES} ${HEADER_FILES})
add_test(Tests UnitTests)

target_link_libraries(UnitTests MyLibrary ${GTEST_BOTH_LIBRARIES})
set_target_properties(UnitTests PROPERTIES FOLDER tests)

add_dependencies(UnitTests ExternalDependencies)

copy_static_files(UnitTests ${CMAKE_CURRENT_BINARY_DIR} "/bin" ${ASSIMP_BINARIES})
copy_static_files(UnitTests ${CMAKE_CURRENT_BINARY_DIR} "/bin" ${BASS_BINARY})

# --- 

# Add all tests to a single target
# https://stackoverflow.com/questions/733475/cmake-ctest-make-test-doesnt-build-tests
add_custom_target(check 
	COMMAND ${CMAKE_CTEST_COMMAND} 
	DEPENDS 
		UnitTests
	)
set_target_properties(check PROPERTIES FOLDER tests)
